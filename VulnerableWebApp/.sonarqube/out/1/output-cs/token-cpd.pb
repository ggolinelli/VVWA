ƒ
aC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Ajax.aspx.cs
	namespace** 	

WebAppDemo**
 
{++ 
public,, 

partial,, 
class,, 
Ajax,, 
:,, 
System,,  &
.,,& '
Web,,' *
.,,* +
UI,,+ -
.,,- .
Page,,. 2
{-- 
	protected.. 
void.. 
	Page_Load..  
(..  !
object..! '
sender..( .
,... /
	EventArgs..0 9
e..: ;
)..; <
{// 	
}11 	
	protected44 
void44 
Button1_Click44 $
(44$ %
object44% +
sender44, 2
,442 3
	EventArgs444 =
e44> ?
)44? @
{55 	
Label166 
.66 
Text66 
=66 
DateTime66 "
.66" #
Now66# &
.66& '
ToString66' /
(66/ 0
)660 1
;661 2
}77 	
	protected:: 
void:: 
Button2_Click:: $
(::$ %
object::% +
sender::, 2
,::2 3
	EventArgs::4 =
e::> ?
)::? @
{;; 	
Label2<< 
.<< 
Text<< 
=<< 
DateTime<< "
.<<" #
Now<<# &
.<<& '
ToString<<' /
(<</ 0
)<<0 1
;<<1 2
}== 	
}>> 
}?? Ë
mC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\CommandInjection.aspx.cs
	namespace** 	

WebAppDemo**
 
{++ 
public,, 

partial,, 
class,, 
CommandInjection,, )
:,,* +
System,,, 2
.,,2 3
Web,,3 6
.,,6 7
UI,,7 9
.,,9 :
Page,,: >
{-- 
string.. 
stdout.. 
=.. 
$str.. 
;.. 
string// 
stderr// 
=// 
$str// 
;// 
string00 
cmd00 
=00 
$str00 
;00 
string11 
comando11 
=11 
$str11 
;11 
	protected33 
void33 
	Page_Load33  
(33  !
object33! '
sender33( .
,33. /
	EventArgs330 9
e33: ;
)33; <
{44 	
comando55 
=55 
Request55 
.55 
Form55 "
[55" #
$str55# ,
]55, -
;55- .
switch88 
(88 
comando88 
)88 
{99 
case:: 
$str:: &
:::& '
cmd;; 
=;; 
$str;; +
;;;+ ,
break<< 
;<< 
case== 
$str== 
:== 
cmd>> 
=>> 
$str>> #
;>># $
break?? 
;?? 
case@@ 
$str@@  
:@@  !
cmdAA 
=AA 
$strAA %
;AA% &
breakBB 
;BB 
defaultCC 
:CC 
returnEE 
;EE 
}HH 
SystemLL
 
.LL 
DiagnosticsLL 
.LL 
ProcessStartInfoLL -
procStartInfoLL. ;
=LL< =
newLL> A
SystemLLB H
.LLH I
DiagnosticsLLI T
.LLT U
ProcessStartInfoLLU e
(LLe f
$strLLf k
,LLk l
$strLLm r
+LLs t
comandoLLu |
)LL| }
;LL} ~
procStartInfoOO 
.OO "
RedirectStandardOutputOO 0
=OO1 2
trueOO3 7
;OO7 8
procStartInfoPP 
.PP !
RedirectStandardErrorPP /
=PP0 1
truePP2 6
;PP6 7
procStartInfoQQ 
.QQ 
UseShellExecuteQQ )
=QQ* +
falseQQ, 1
;QQ1 2
procStartInfoSS 
.SS 
CreateNoWindowSS (
=SS) *
trueSS+ /
;SS/ 0
SystemUU 
.UU 
DiagnosticsUU 
.UU 
ProcessUU &
pUU' (
=UU) *
newUU+ .
SystemUU/ 5
.UU5 6
DiagnosticsUU6 A
.UUA B
ProcessUUB I
(UUI J
)UUJ K
;UUK L
pVV 
.VV 
	StartInfoVV 
=VV 
procStartInfoVV '
;VV' (
pWW 
.WW 
StartWW 
(WW 
)WW 
;WW 
stdoutYY 
=YY 
pYY 
.YY 
StandardOutputYY %
.YY% &
	ReadToEndYY& /
(YY/ 0
)YY0 1
;YY1 2
stderrZZ 
=ZZ 
pZZ 
.ZZ 
StandardErrorZZ $
.ZZ$ %
	ReadToEndZZ% .
(ZZ. /
)ZZ/ 0
;ZZ0 1
Label1[[ 
.[[ 
Text[[ 
=[[ 
stdout[[  
.[[  !
Replace[[! (
([[( )
$str[[) ,
,[[, -
$str[[. 4
)[[4 5
;[[5 6
Label2\\ 
.\\ 
Text\\ 
=\\ 
stderr\\  
.\\  !
Replace\\! (
(\\( )
$str\\) ,
,\\, -
$str\\. 4
)\\4 5
;\\5 6
}]] 	
}__ 
}`` ˘
dC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Default.aspx.cs
	namespace** 	

WebAppDemo**
 
{++ 
public,, 

partial,, 
class,, 
Default1,, !
:,," #
System,,$ *
.,,* +
Web,,+ .
.,,. /
UI,,/ 1
.,,1 2
Page,,2 6
{-- 
	protected.. 
void.. 
	Page_Load..  
(..  !
object..! '
sender..( .
,... /
	EventArgs..0 9
e..: ;
)..; <
{// 	
}11 	
}22 
}33 ˙
jC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\FileInjection.aspx.cs
	namespace++ 	

WebAppDemo++
 
{,, 
public-- 

partial-- 
class-- 
FileInjection-- &
:--' (
System--) /
.--/ 0
Web--0 3
.--3 4
UI--4 6
.--6 7
Page--7 ;
{.. 
string// 
path// 
;// 
	protected11 
void11 
	Page_Load11  
(11  !
object11! '
sender11( .
,11. /
	EventArgs110 9
e11: ;
)11; <
{22 	
path55 
=55 
$str55 
;55 
}66 	
	protected88 
void88 
Button1_Click88 $
(88$ %
object88% +
sender88, 2
,882 3
	EventArgs884 =
e88> ?
)88? @
{99 	
string:: 
filePath:: 
=:: 
FileUpload1:: )
.::) *

PostedFile::* 4
.::4 5
FileName::5 =
;::= >
string;; 
filename;; 
=;; 
Path;; "
.;;" #
GetFileName;;# .
(;;. /
filePath;;/ 7
);;7 8
;;;8 9
string<< 
ext<< 
=<< 
Path<< 
.<< 
GetExtension<< *
(<<* +
filename<<+ 3
)<<3 4
;<<4 5
path?? 
=?? 
Server?? 
.?? 
MapPath?? !
(??! "
$str??" .
)??. /
;??/ 0
FileUpload1@@ 
.@@ 

PostedFile@@ "
.@@" #
SaveAs@@# )
(@@) *
path@@* .
+@@/ 0
FileUpload1@@1 <
.@@< =
FileName@@= E
)@@E F
;@@F G
}
ÜÜ 	
}
áá 
}àà ê
cC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Global.asax.cs
	namespace** 	

WebAppDemo**
 
{++ 
public,, 

class,, 
Global,, 
:,, 
System,,  
.,,  !
Web,,! $
.,,$ %
HttpApplication,,% 4
{-- 
	protected.. 
void.. 
Application_Start.. (
(..( )
object..) /
sender..0 6
,..6 7
	EventArgs..8 A
e..B C
)..C D
{// 	
}00 	
void22 
Session_Start22 
(22 
object22 !
sender22" (
,22( )
	EventArgs22* 3
e224 5
)225 6
{33 	
Session44 
[44 
$str44 
]44 
=44 
$str44  "
;44" #
}55 	
}66 
}77 Œ
cC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\HTTPRS.aspx.cs
	namespace** 	

WebAppDemo**
 
{++ 
public,, 

partial,, 
class,, 
HTTPRS,, 
:,,  !
System,," (
.,,( )
Web,,) ,
.,,, -
UI,,- /
.,,/ 0
Page,,0 4
{-- 
	protected.. 
void.. 
	Page_Load..  
(..  !
object..! '
sender..( .
,... /
	EventArgs..0 9
e..: ;
)..; <
{// 	
if00 
(00 
Page00 
.00 

IsPostBack00 
==00  "
true00# '
)00' (
{11 

HttpCookie33 
	miocookie33 $
=33% &
Request33' .
.33. /
Unvalidated33/ :
.33: ;
Cookies33; B
[33B C
$str33C K
]33K L
;33L M
Label244 
.44 
Text44 
=44 
	miocookie44 '
.44' (
Values44( .
[44. /
$str44/ 7
]447 8
;448 9
}<< 
else== 
{>> 
string?? 
autore?? 
=?? 
Request??  '
.??' (
Unvalidated??( 3
.??3 4
QueryString??4 ?
[??? @
$str??@ H
]??H I
;??I J

HttpCookie@@ 
cookiegioco@@ &
=@@' (
new@@) ,

HttpCookie@@- 7
(@@7 8
$str@@8 @
)@@@ A
;@@A B
cookiegiocoAA 
.AA 
ValuesAA "
.AA" #
AddAA# &
(AA& '
$strAA' /
,AA/ 0
autoreAA1 7
)AA7 8
;AA8 9
cookiegiocoBB 
.BB 
ExpiresBB #
=BB$ %
DateTimeBB& .
.BB. /
NowBB/ 2
.BB2 3
AddDaysBB3 :
(BB: ;
$numBB; <
)BB< =
;BB= >
ResponseCC 
.CC 
CookiesCC  
.CC  !
AddCC! $
(CC$ %
cookiegiocoCC% 0
)CC0 1
;CC1 2
Label2DD 
.DD 
TextDD 
=DD 
autoreDD $
;DD$ %
}EE 
}FF 	
	protectedII 
voidII 
Button2_ClickII $
(II$ %
objectII% +
senderII, 2
,II2 3
	EventArgsII4 =
eII> ?
)II? @
{JJ 	
}LL 	
	protectedOO 
voidOO 
Button3_ClickOO $
(OO$ %
objectOO% +
senderOO, 2
,OO2 3
	EventArgsOO4 =
eOO> ?
)OO? @
{PP 	
ResponseRR 
.RR 
RedirectRR 
(RR 
$str	RR Í
)
RRÍ Î
;
RRÎ Ï
}SS 	
}TT 
}UU œ
jC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\LDAPInjection.aspx.cs
	namespace

 	

WebAppDemo


 
{ 
public 

partial 
class 
LDAPInjection &
:' (
System) /
./ 0
Web0 3
.3 4
UI4 6
.6 7
Page7 ;
{ 
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
} 	
	protected 
void 
Button1_Click $
($ %
object% +
sender, 2
,2 3
	EventArgs4 =
e> ?
)? @
{ 	
string 
username 
= 
$str #
,# $
password% -
=- .
$str. 8
;8 9
string 
uid 
= 
$str 
; 
try 
{ 
DirectoryEntry 
	rootEntry (
=) *
new+ .
DirectoryEntry/ =
(= >
$str> s
)s t
;t u
	rootEntry 
. 
AuthenticationType ,
=- .
AuthenticationTypes/ B
.B C
	AnonymousC L
;L M
DirectorySearcher !
searcher" *
=+ ,
new- 0
DirectorySearcher1 B
(B C
	rootEntryC L
)L M
;M N
uid!! 
=!! 
TextBox1!! 
.!! 
Text!! #
;!!# $
var## 
queryFormat## 
=##  !
$str##" F
+##G H
uid##I L
+##M N
$str##N R
;##R S
searcher%% 
.%% 
Filter%% 
=%%  !
queryFormat%%" -
;%%- .
foreach&& 
(&& 
SearchResult&& %
result&&& ,
in&&- /
searcher&&0 8
.&&8 9
FindAll&&9 @
(&&@ A
)&&A B
)&&B C
{'' 
if(( 
((( 
result(( 
.(( 

Properties(( )
[(() *
$str((* 7
]((7 8
.((8 9
Count((9 >
>((? @
$num((A B
)((B C
Response))  
.))  !
Write))! &
())& '
$str))' 7
+))8 9
result)): @
.))@ A

Properties))A K
[))K L
$str))L Y
]))Y Z
[))Z [
$num))[ \
]))\ ]
+))^ _
$str))` g
)))g h
;))h i
else** 
Response++  
.++  !
Write++! &
(++& '
$str++' )
)++) *
;++* +
if-- 
(-- 
result-- 
.-- 

Properties-- )
[--) *
$str--* .
]--. /
.--/ 0
Count--0 5
>--6 7
$num--8 9
)--9 :
Response..  
...  !
Write..! &
(..& '
$str..' 6
+..7 8
result..9 ?
...? @

Properties..@ J
[..J K
$str..K O
]..O P
[..P Q
$num..Q R
]..R S
+..T U
$str..V ]
)..] ^
;..^ _
else// 
Response00  
.00  !
Write00! &
(00& '
$str00' )
)00) *
;00* +
}11 
}22 
catch33 
(33 
	Exception33 
excp33  
)33  !
{44 
Response55 
.55 
Write55 
(55 
excp55 #
.55# $
Message55$ +
)55+ ,
;55, -
}66 
}77 	
}88 
}99 ⁄
`C:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\LFI.aspx.cs
	namespace,, 	

WebAppDemo,,
 
{-- 
public.. 

partial.. 
class.. 
LFI.. 
:.. 
System.. %
...% &
Web..& )
...) *
UI..* ,
..., -
Page..- 1
{// 
string00 
filename00 
;00 
	protected22 
void22 
	Page_Load22  
(22  !
object22! '
sender22( .
,22. /
	EventArgs220 9
e22: ;
)22; <
{33 	
filename55 
=55 
Request55 
.55 
QueryString55 *
[55* +
$str55+ /
]55/ 0
;550 1
TextBox1DD 
.DD 
TextDD 
=DD 
filenameDD $
;DD$ %
}EE 	
	protectedGG 
voidGG 
Button1_ClickGG $
(GG$ %
objectGG% +
senderGG, 2
,GG2 3
	EventArgsGG4 =
eGG> ?
)GG? @
{HH 	
ServerJJ 
.JJ 
ExecuteJJ 
(JJ 
TextBox1JJ #
.JJ# $
TextJJ$ (
)JJ( )
;JJ) *
}KK 	
	protectedMM 
voidMM 
Button2_ClickMM $
(MM$ %
objectMM% +
senderMM, 2
,MM2 3
	EventArgsMM4 =
eMM> ?
)MM? @
{NN 	
ResponsePP 
.PP 
	WriteFilePP 
(PP 
TextBox1PP '
.PP' (
TextPP( ,
)PP, -
;PP- .
}QQ 	
	protectedSS 
voidSS 
Button3_ClickSS $
(SS$ %
objectSS% +
senderSS, 2
,SS2 3
	EventArgsSS4 =
eSS> ?
)SS? @
{TT 	
stringVV 
readTextVV 
=VV 
FileVV "
.VV" #
ReadAllTextVV# .
(VV. /
TextBox1VV/ 7
.VV7 8
TextVV8 <
)VV< =
;VV= >
ResponseXX 
.XX 
WriteXX 
(XX 
readTextXX #
)XX# $
;XX$ %
}YY 	
}ZZ 
}[[ ÚO
gC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\lib\Cryptograpy.cs
	namespace++ 	

WebAppDemo++
 
.++ 
lib++ 
{,, 
public-- 

class-- 
Cryptograpy-- 
{.. 
public00 
static00 
byte00 
[00 
]00 
	passw_aes00 &
=00' (
new00) ,
byte00- 1
[001 2
]002 3
{004 5
$num006 8
,008 9
$num00: <
,00< =
$num00> ?
,00? @
$num00A B
,00B C
$num00D E
,00E F
$num00G H
,00H I
$num00J M
,00M N
$num00O R
,00R S
$num00T V
,00V W
$num00X Y
,00Y Z
$num00[ ]
,00] ^
$num00_ a
,00a b
$num00c e
,00e f
$num00g h
,00h i
$num00j k
,00k l
$num00m o
}00p q
;00q r
public22 
static22 
byte22 
[22 
]22 
salt_aes22 %
=22& '
new22( +
byte22, 0
[220 1
]221 2
{223 4
$num225 6
,226 7
$num228 9
,229 :
$num22; =
,22= >
$num22? A
,22A B
$num22C D
,22D E
$num22F G
,22G H
$num22I K
,22K L
$num22M O
,22O P
$num22Q R
,22R S
$num22T V
,22V W
$num22X Y
,22Y Z
$num22[ ]
,22] ^
$num22_ `
,22` a
$num22b d
,22d e
$num22f h
,22h i
$num22j k
}22l m
;22m n
public44 
static44 
byte44 
[44 
]44 
	salt_aes244 &
=44' (
new44) ,
byte44- 1
[441 2
]442 3
{444 5
$num446 7
,447 8
$num449 ;
,44; <
$num44= >
,44> ?
$num44@ B
,44B C
$num44D E
,44E F
$num44G H
,44H I
$num44J L
,44L M
$num44N O
,44O P
$num44Q R
,44R S
$num44T V
,44V W
$num44X Y
,44Y Z
$num44[ ]
,44] ^
$num44_ `
,44` a
$num44b c
,44c d
$num44e g
,44g h
$num44i k
}44l m
;44m n
public66 
Cryptograpy66 
(66 
)66 
{77 	
}99 	
public<< 
string<< 
compute_hash<< "
(<<" #
string<<# )
input_string<<* 6
)<<6 7
{== 	
string>> 
output_string>>  
=>>! "
$str>># %
;>>% &
byte@@ 
[@@ 
]@@ 
data@@ 
=@@ 
System@@  
.@@  !
Text@@! %
.@@% &
Encoding@@& .
.@@. /
UTF8@@/ 3
.@@3 4
GetBytes@@4 <
(@@< =
input_string@@= I
)@@I J
;@@J K
byteAA 
[AA 
]AA 
resultAA 
;AA 
SHA1ManagedDD 
sha1DD 
=DD 
newDD "
SHA1ManagedDD# .
(DD. /
)DD/ 0
;DD0 1
resultEE 
=EE 
sha1EE 
.EE 
ComputeHashEE %
(EE% &
dataEE& *
)EE* +
;EE+ ,
output_stringGG 
=GG 
SystemGG "
.GG" #
TextGG# '
.GG' (
EncodingGG( 0
.GG0 1
UTF8GG1 5
.GG5 6
	GetStringGG6 ?
(GG? @
resultGG@ F
)GGF G
;GGG H
returnII 
output_stringII  
;II  !
}JJ 	
publicMM 
stringMM 
compute_hash_sha2MM '
(MM' (
stringMM( .
input_stringMM/ ;
)MM; <
{NN 	
stringOO 
output_stringOO  
=OO! "
$strOO# %
;OO% &
byteQQ 
[QQ 
]QQ 
dataQQ 
=QQ 
SystemQQ  
.QQ  !
TextQQ! %
.QQ% &
EncodingQQ& .
.QQ. /
UTF8QQ/ 3
.QQ3 4
GetBytesQQ4 <
(QQ< =
input_stringQQ= I
)QQI J
;QQJ K
byteRR 
[RR 
]RR 
resultRR 
;RR 
SHA512ManagedUU 
sha1UU 
=UU  
newUU! $
SHA512ManagedUU% 2
(UU2 3
)UU3 4
;UU4 5
resultVV 
=VV 
sha1VV 
.VV 
ComputeHashVV %
(VV% &
dataVV& *
)VV* +
;VV+ ,
output_stringXX 
=XX 
SystemXX "
.XX" #
TextXX# '
.XX' (
EncodingXX( 0
.XX0 1
UTF8XX1 5
.XX5 6
	GetStringXX6 ?
(XX? @
resultXX@ F
)XXF G
;XXG H
returnZZ 
output_stringZZ  
;ZZ  !
}[[ 	
public^^ 
static^^ 
byte^^ 
[^^ 
]^^ $
EncryptStringToBytes_Aes^^ 5
(^^5 6
string^^6 <
	plainText^^= F
,^^F G
byte^^H L
[^^L M
]^^M N
Key^^O R
,^^R S
byte^^T X
[^^X Y
]^^Y Z
IV^^[ ]
)^^] ^
{__ 	
byte`` 
[`` 
]`` 
	encrypted`` 
;`` 
usingbb 
(bb 

AesManagedbb 
aesAlgbb $
=bb% &
newbb' *

AesManagedbb+ 5
(bb5 6
)bb6 7
)bb7 8
{cc 
aesAlgdd 
.dd 
Keydd 
=dd 
Keydd  
;dd  !
aesAlgee 
.ee 
IVee 
=ee 
IVee 
;ee 
ICryptoTransformgg  
	encryptorgg! *
=gg+ ,
aesAlggg- 3
.gg3 4
CreateEncryptorgg4 C
(ggC D
aesAlgggD J
.ggJ K
KeyggK N
,ggN O
aesAlgggP V
.ggV W
IVggW Y
)ggY Z
;ggZ [
usingii 
(ii 
MemoryStreamii #
	msEncryptii$ -
=ii. /
newii0 3
MemoryStreamii4 @
(ii@ A
)iiA B
)iiB C
{jj 
usingkk 
(kk 
CryptoStreamkk '
	csEncryptkk( 1
=kk2 3
newkk4 7
CryptoStreamkk8 D
(kkD E
	msEncryptkkE N
,kkN O
	encryptorkkP Y
,kkY Z
CryptoStreamModekk[ k
.kkk l
Writekkl q
)kkq r
)kkr s
{ll 
usingmm 
(mm 
StreamWritermm +
	swEncryptmm, 5
=mm6 7
newmm8 ;
StreamWritermm< H
(mmH I
	csEncryptmmI R
)mmR S
)mmS T
{nn 
	swEncryptoo %
.oo% &
Writeoo& +
(oo+ ,
	plainTextoo, 5
)oo5 6
;oo6 7
}pp 
	encryptedrr !
=rr" #
	msEncryptrr$ -
.rr- .
ToArrayrr. 5
(rr5 6
)rr6 7
;rr7 8
}ss 
}tt 
}vv 
returnww 
	encryptedww 
;ww 
}yy 	
public|| 
static|| 
string|| '
DencryptStringFromBytes_Aes|| 8
(||8 9
byte||9 =
[||= >
]||> ?

cipherText||@ J
,||J K
byte||L P
[||P Q
]||Q R
Key||S V
,||V W
byte||X \
[||\ ]
]||] ^
IV||_ a
)||a b
{}} 	
string~~ 
	plaintext~~ 
=~~ 
null~~ #
;~~# $
try
ÄÄ 
{
ÅÅ 
using
ÇÇ 
(
ÇÇ 

AesManaged
ÇÇ !
aesAlg
ÇÇ" (
=
ÇÇ) *
new
ÇÇ+ .

AesManaged
ÇÇ/ 9
(
ÇÇ9 :
)
ÇÇ: ;
)
ÇÇ; <
{
ÉÉ 
aesAlg
ÑÑ 
.
ÑÑ 
Key
ÑÑ 
=
ÑÑ  
Key
ÑÑ! $
;
ÑÑ$ %
aesAlg
ÖÖ 
.
ÖÖ 
IV
ÖÖ 
=
ÖÖ 
IV
ÖÖ  "
;
ÖÖ" #
ICryptoTransform
áá $
	decryptor
áá% .
=
áá/ 0
aesAlg
áá1 7
.
áá7 8
CreateDecryptor
áá8 G
(
ááG H
aesAlg
ááH N
.
ááN O
Key
ááO R
,
ááR S
aesAlg
ááT Z
.
ááZ [
IV
áá[ ]
)
áá] ^
;
áá^ _
using
àà 
(
àà 
MemoryStream
àà '
	msDecrypt
àà( 1
=
àà2 3
new
àà4 7
MemoryStream
àà8 D
(
ààD E

cipherText
ààE O
)
ààO P
)
ààP Q
{
ââ 
using
ää 
(
ää 
CryptoStream
ää +
	csDecrypt
ää, 5
=
ää6 7
new
ää8 ;
CryptoStream
ää< H
(
ääH I
	msDecrypt
ääI R
,
ääR S
	decryptor
ääT ]
,
ää] ^
CryptoStreamMode
ää_ o
.
ääo p
Read
ääp t
)
äät u
)
ääu v
{
ãã 
using
åå !
(
åå" #
StreamReader
åå# /
	srDecrypt
åå0 9
=
åå: ;
new
åå< ?
StreamReader
åå@ L
(
ååL M
	csDecrypt
ååM V
)
ååV W
)
ååW X
{
çç 
	plaintext
éé  )
=
éé* +
	srDecrypt
éé, 5
.
éé5 6
	ReadToEnd
éé6 ?
(
éé? @
)
éé@ A
;
ééA B
}
èè 
}
êê 
}
íí 
}
îî 
return
ïï 
	plaintext
ïï  
;
ïï  !
}
ññ 
catch
óó 
(
óó 
	Exception
óó 
excp
óó !
)
óó! "
{
òò 
return
ôô 
	plaintext
ôô  
;
ôô  !
}
öö 
}
õõ 	
}
ùù 
}ûû ù=
bC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\login.aspx.cs
	namespace.. 	

WebAppDemo..
 
{// 
public00 

partial00 
class00 
login00 
:00  
System00! '
.00' (
Web00( +
.00+ ,
UI00, .
.00. /
Page00/ 3
{11 
	protected22 
void22 
	Page_Load22  
(22  !
object22! '
sender22( .
,22. /
	EventArgs220 9
e22: ;
)22; <
{33 	
}55 	
	protected77 
void77 
Button1_Click77 $
(77$ %
object77% +
sender77, 2
,772 3
	EventArgs774 =
e77> ?
)77? @
{88 	
string:: 
nometabella:: 
,:: 
ConnectionString::  0
,::0 1
QueryString::2 =
;::= >
string;; 
strTemp;; 
=;; 
$str;; 
;;;  
SqlConnection<< 
cn<< 
;<< 

SqlCommand== 
cmd== 
;== 
SqlDataReader>> 
rs>> 
;>> 
SqlParameter?? 
param1?? 
,??  
param2??! '
;??' (
int@@ 
num@@ 
;@@ 
stringAA 
hashAA 
=AA 
$strAA 
,AA 
hash_retrievedAA ,
=AA, -
$strAA- /
;AA/ 0
nometabellaCC 
=CC 
$strCC #
;CC# $
Label3DD 
.DD 
TextDD 
=DD 
$strDD 
;DD 
tryFF 
{GG 
CryptograpyII 
cryptII 
=II 
newII  #
CryptograpyII$ /
(II/ 0
)II0 1
;II1 2
cmdKK 
=KK 
newKK 

SqlCommandKK  
(KK  !
)KK! "
;KK" #
cnLL 
=LL 
newLL 
SqlConnectionLL "
(LL" #
)LL# $
;LL$ %
param1MM 
=MM 
newMM 
SqlParameterMM %
(MM% &
)MM& '
;MM' (
param2NN 
=NN 
newNN 
SqlParameterNN %
(NN% &
)NN& '
;NN' (
cmdPP 
.PP 
CommandTimeoutPP 
=PP  
$numPP! #
;PP# $
cmdQQ 
.QQ 
CommandTypeQQ 
=QQ 
CommandTypeQQ )
.QQ) *
TextQQ* .
;QQ. /
param1UU 
.UU 
ParameterNameUU  
=UU! "
$strUU# ,
;UU, -
param1VV 
.VV 
DbTypeVV 
=VV 
DbTypeVV "
.VV" #
StringVV# )
;VV) *
param2WW 
.WW 
ParameterNameWW  
=WW! "
$strWW# .
;WW. /
param2XX 
.XX 
DbTypeXX 
=XX 
DbTypeXX "
.XX" #
StringXX# )
;XX) *
param1YY 
.YY 
	SqlDbTypeYY 
=YY 
	SqlDbTypeYY (
.YY( )
NVarCharYY) 1
;YY1 2
param1ZZ 
.ZZ 
ValueZZ 
=ZZ 
usernameZZ #
.ZZ# $
TextZZ$ (
;ZZ( )
param1[[ 
.[[ 
	Direction[[ 
=[[ 
ParameterDirection[[ 1
.[[1 2
Input[[2 7
;[[7 8
param2\\ 
.\\ 
	SqlDbType\\ 
=\\ 
	SqlDbType\\ (
.\\( )
NVarChar\\) 1
;\\1 2
hash]] 
=]] 
crypt]] 
.]] 
compute_hash]] %
(]]% &
paswd]]& +
.]]+ ,
Text]], 0
)]]0 1
;]]1 2
param2^^ 
.^^ 
Value^^ 
=^^ 
hash^^ 
;^^  
param2__ 
.__ 
	Direction__ 
=__ 
ParameterDirection__ 1
.__1 2
Input__2 7
;__7 8
cmd`` 
.`` 

Parameters`` 
.`` 
Add`` 
(`` 
param1`` %
)``% &
;``& '
cmdaa 
.aa 

Parametersaa 
.aa 
Addaa 
(aa 
param2aa %
)aa% &
;aa& '
ConnectionStringff 
=ff 
$str	ff ü
;
ffü †
cngg 
.gg 
ConnectionStringgg 
=gg  !
ConnectionStringgg" 2
;gg2 3
cnhh 
.hh 
Openhh 
(hh 
)hh 
;hh 
cmdii 
.ii 

Connectionii 
=ii 
cnii 
;ii  
QueryStringtt 
=tt 
$strtt *
+tt+ ,
nometabellatt- 8
+tt9 :
$struu !
+uu" #
usernameuu$ ,
.uu, -
Textuu- 1
+uu2 3
$struu4 F
+vv 
paswdvv 
.vv 
Textvv 
+vv 
$strvv "
;vv" #
cmd~~ 
.~~ 
CommandText~~ 
=~~ 
QueryString~~ )
;~~) *
rs
ÄÄ 
=
ÄÄ 
cmd
ÄÄ 
.
ÄÄ 
ExecuteReader
ÄÄ "
(
ÄÄ" #
)
ÄÄ# $
;
ÄÄ$ %
num
ÇÇ 
=
ÇÇ 
$num
ÇÇ 
;
ÇÇ 
while
ÑÑ 
(
ÑÑ 
rs
ÑÑ 
.
ÑÑ 
Read
ÑÑ 
(
ÑÑ 
)
ÑÑ 
)
ÑÑ 
{
ÖÖ 
num
ÜÜ 
++
ÜÜ 
;
ÜÜ 
if
áá 
(
áá 
!
áá 
rs
áá 
.
áá 
IsDBNull
áá  
(
áá  !
$num
áá! "
)
áá" #
)
áá# $
strTemp
àà 
=
àà 
rs
àà  
.
àà  !
	GetString
àà! *
(
àà* +
$num
àà+ ,
)
àà, -
;
àà- .
if
ââ 
(
ââ 
!
ââ 
rs
ââ 
.
ââ 
IsDBNull
ââ  
(
ââ  !
$num
ââ! "
)
ââ" #
)
ââ# $
{
ää 
strTemp
ãã 
=
ãã 
strTemp
ãã %
+
ãã& '
$str
ãã( -
+
ãã. /
rs
ãã0 2
.
ãã2 3
	GetString
ãã3 <
(
ãã< =
$num
ãã= >
)
ãã> ?
;
ãã? @
hash_retrieved
åå "
=
åå# $
rs
åå% '
.
åå' (
	GetString
åå( 1
(
åå1 2
$num
åå2 3
)
åå3 4
;
åå4 5
}
çç 
Label3
êê 
.
êê 
Text
êê 
=
êê 
strTemp
êê %
;
êê% &
}
ëë 
rs
íí 
.
íí 
Close
íí 
(
íí 
)
íí 
;
íí 
cn
ìì 
.
ìì 
Close
ìì 
(
ìì 
)
ìì 
;
ìì 
if
ïï 
(
ïï 
num
ïï 
>
ïï 
$num
ïï 
)
ïï 
{
ññ !
FormsAuthentication
òò #
.
òò# $#
RedirectFromLoginPage
òò$ 9
(
òò9 :
username
òò: B
.
òòB C
Text
òòC G
,
òòG H
false
òòI N
)
òòN O
;
òòO P
}
ôô 
else
öö 
{
õõ 
Label3
ùù 
.
ùù 
Text
ùù 
=
ùù 
$str
ùù C
;
ùùC D
}
ûû 
}
üü 
catch
†† 
(
†† 
	Exception
†† 
excp
††  
)
††  !
{
°° 
}
§§ 
}
ßß 	
}
®® 
}©© Œ
rC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\pageforstaticanalysis.aspx.cs
	namespace		 	

WebAppDemo		
 
{

 
public 

partial 
class !
pageforstaticanalysis .
:/ 0
System1 7
.7 8
Web8 ;
.; <
UI< >
.> ?
Page? C
{ 
public 
int 
[ 
] 
vettore 
= 
{  
$num! "
," #
$num$ %
,% &
$num' (
,( )
$num* +
,+ ,
$num- .
}/ 0
;0 1
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
} 	
	protected 
void 
Button1_Click $
($ %
object% +
sender, 2
,2 3
	EventArgs4 =
e> ?
)? @
{ 	
int 
z 
; 
z 
=  
code_analysis_method $
($ %
)% &
;& '
} 	
int  
code_analysis_method  
(  !
)! "
{ 	
int 
x 
= 
$num 
, 
y 
= 
$num 
; 
Cryptograpy 
crypt 
= 
null "
;" #
bool 
check 
= 
true 
; 
x"" 
="" 
$num"" 
;"" 
if$$ 
($$ 
x$$ 
==$$ 
$num$$ 
)$$ 
{%% 
y&& 
=&& 
y&& 
+&& 
$num&& 
;&& 
}'' 
crypt)) 
.)) 
compute_hash)) 
()) 
$str)) &
)))& '
;))' (
while++ 
(++ 
check++ 
!=++ 
false++ !
)++! "
{,, 
y-- 
=-- 
y-- 
+-- 
$num-- 
;-- 
if.. 
(.. 
x.. 
==.. 
$num.. 
).. 
check.. !
=.." #
false..$ )
;..) *
}// 
string22 
[22 
]22 
s22 
=22 
new22 
string22 #
[22# $
$num22$ %
]22% &
;22& '
s33 
[33 
$num33 
]33 
=33 
$str33 
;33  
int55 
w55 
=55 
$num55 
,55 
v55 
=55 
$num55 
;55 
int66 
z66 
=66 
w66 
/66 
v66 
;66 
return88 
y88 
;88 
}99 	
}<< 
}== ‹.
iC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\PostJsonData.aspx.cs
	namespace// 	

WebAppDemo//
 
{00 
public11 

partial11 
class11 
PostJsonData11 %
:11& '
System11( .
.11. /
Web11/ 2
.112 3
UI113 5
.115 6
Page116 :
{22 
	protected33 
void33 
	Page_Load33  
(33  !
object33! '
sender33( .
,33. /
	EventArgs330 9
e33: ;
)33; <
{44 	
}66 	
	protected99 
void99 
Button1_Click99 $
(99$ %
object99% +
sender99, 2
,992 3
	EventArgs994 =
e99> ?
)99? @
{:: 	
var;; 
request;; 
=;; 
(;; 
HttpWebRequest;; )
);;) *

WebRequest;;* 4
.;;4 5
Create;;5 ;
(;;; <
$str;;< f
);;f g
;;;g h
var== 
postData== 
=== 
$str== H
;==H I
var?? 
data?? 
=?? 
Encoding?? 
.??  
ASCII??  %
.??% &
GetBytes??& .
(??. /
postData??/ 7
)??7 8
;??8 9
requestAA 
.AA 
MethodAA 
=AA 
$strAA #
;AA# $
requestBB 
.BB 
ContentTypeBB 
=BB  !
$strBB" 4
;BB4 5
requestCC 
.CC 
AcceptCC 
=CC 
$strCC /
;CC/ 0
requestDD 
.DD 
ContentLengthDD !
=DD" #
dataDD$ (
.DD( )
LengthDD) /
;DD/ 0
usingFF 
(FF 
varFF 
streamFF 
=FF 
requestFF  '
.FF' (
GetRequestStreamFF( 8
(FF8 9
)FF9 :
)FF: ;
{GG 
streamHH 
.HH 
WriteHH 
(HH 
dataHH !
,HH! "
$numHH# $
,HH$ %
dataHH& *
.HH* +
LengthHH+ 1
)HH1 2
;HH2 3
}II 
varKK 
responseKK 
=KK 
(KK 
HttpWebResponseKK +
)KK+ ,
requestKK, 3
.KK3 4
GetResponseKK4 ?
(KK? @
)KK@ A
;KKA B
varMM 
responseStringMM 
=MM  
newMM! $
StreamReaderMM% 1
(MM1 2
responseMM2 :
.MM: ;
GetResponseStreamMM; L
(MML M
)MMM N
)MMN O
.MMO P
	ReadToEndMMP Y
(MMY Z
)MMZ [
;MM[ \
ResponseNN 
.NN 
WriteNN 
(NN 
responseStringNN )
)NN) *
;NN* +
}OO 	
	protectedRR 
voidRR 
Button2_ClickRR $
(RR$ %
objectRR% +
senderRR, 2
,RR2 3
	EventArgsRR4 =
eRR> ?
)RR? @
{SS 	
stringTT 
responseFromServerTT %
;TT% &
HttpWebRequestVV 
requestVV "
=VV# $
(VV% &
HttpWebRequestVV& 4
)VV4 5

WebRequestVV5 ?
.VV? @
CreateVV@ F
(VVF G
$strVVG `
)VV` a
;VVa b
requestYY 
.YY 
CredentialsYY 
=YY  !
CredentialCacheYY" 1
.YY1 2
DefaultCredentialsYY2 D
;YYD E
var[[ 
response[[ 
=[[ 
request[[ "
.[[" #
GetResponse[[# .
([[. /
)[[/ 0
;[[0 1
Stream^^ 

dataStream^^ 
=^^ 
response^^  (
.^^( )
GetResponseStream^^) :
(^^: ;
)^^; <
;^^< =
StreamReaderaa 
readeraa 
=aa  !
newaa" %
StreamReaderaa& 2
(aa2 3

dataStreamaa3 =
)aa= >
;aa> ?
responseFromServercc 
=cc  
readercc! '
.cc' (
	ReadToEndcc( 1
(cc1 2
)cc2 3
;cc3 4
varee 
productobjectee 
=ee 
JsonConvertee  +
.ee+ ,
DeserializeObjectee, =
<ee= >
Listee> B
<eeB C
ProdottoeeC K
>eeK L
>eeL M
(eeM N
responseFromServereeN `
)ee` a
;eea b
foreachgg 
(gg 
Prodottogg 
pgg 
ingg  "
productobjectgg# 0
)gg0 1
{hh 
Responseii 
.ii 
Writeii 
(ii 
$strii &
+ii' (
pii) *
.ii* +
idii+ -
+ii. /
$strii0 7
)ii7 8
;ii8 9
Responsejj 
.jj 
Writejj 
(jj 
pjj  
.jj  !
prodottojj! )
+jj* +
$strjj, 3
)jj3 4
;jj4 5
Responsekk 
.kk 
Writekk 
(kk 
pkk  
.kk  !
costokk! &
+kk' (
$strkk) 0
)kk0 1
;kk1 2
}ll 
}oo 	
} 
public
ÅÅ 

class
ÅÅ 
Prodotto
ÅÅ 
{
ÇÇ 
public
ÉÉ 
int
ÉÉ 
id
ÉÉ 
{
ÉÉ 
get
ÉÉ 
;
ÉÉ 
set
ÉÉ  
;
ÉÉ  !
}
ÉÉ" #
public
ÑÑ 
string
ÑÑ 
prodotto
ÑÑ 
{
ÑÑ  
get
ÑÑ! $
;
ÑÑ$ %
set
ÑÑ& )
;
ÑÑ) *
}
ÑÑ+ ,
public
ÖÖ 
double
ÖÖ 
costo
ÖÖ 
{
ÖÖ 
get
ÖÖ !
;
ÖÖ! "
set
ÖÖ# &
;
ÖÖ& '
}
ÖÖ( )
}
ÜÜ 
}àà ¥-
lC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Private\newuser.aspx.cs
	namespace 	

WebAppDemo
 
. 
Private 
{ 
public 

partial 
class 
newuser  
:! "
System# )
.) *
Web* -
.- .
UI. 0
.0 1
Page1 5
{ 
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
} 	
	protected 
void 
Button1_Click $
($ %
object% +
sender, 2
,2 3
	EventArgs4 =
e> ?
)? @
{ 	
string 
nometabella 
, 
ConnectionString  0
,0 1
QueryString2 =
;= >
string 
hash 
= 
$str 
; 
SqlConnection 
cn 
; 

SqlCommand 
cmd 
; 
SqlParameter 
param1 
,  
param2! '
,' (
param3) /
;/ 0
Cryptograpy 
crypt 
= 
new  #
Cryptograpy$ /
(/ 0
)0 1
;1 2
nometabella 
= 
$str #
;# $
Label3 
. 
Text 
= 
$str 
; 
cmd## 
=## 
new## 

SqlCommand##  
(##  !
)##! "
;##" #
cn$$ 
=$$ 
new$$ 
SqlConnection$$ "
($$" #
)$$# $
;$$$ %
param1%% 
=%% 
new%% 
SqlParameter%% %
(%%% &
)%%& '
;%%' (
param2&& 
=&& 
new&& 
SqlParameter&& %
(&&% &
)&&& '
;&&' (
param3'' 
='' 
new'' 
SqlParameter'' %
(''% &
)''& '
;''' (
cmd)) 
.)) 
CommandTimeout)) 
=))  
$num))! #
;))# $
cmd** 
.** 
CommandType** 
=** 
CommandType** )
.**) *
Text*** .
;**. /
param1,, 
.,, 
ParameterName,,  
=,,! "
$str,,# ,
;,,, -
param1-- 
.-- 
DbType-- 
=-- 
DbType-- "
.--" #
String--# )
;--) *
param2.. 
... 
ParameterName..  
=..! "
$str..# .
;... /
param2// 
.// 
DbType// 
=// 
DbType// "
.//" #
String//# )
;//) *
param100 
.00 
	SqlDbType00 
=00 
	SqlDbType00 (
.00( )
NVarChar00) 1
;001 2
param111 
.11 
Value11 
=11 
TextBox111 #
.11# $
Text11$ (
;11( )
param122 
.22 
	Direction22 
=22 
ParameterDirection22 1
.221 2
Input222 7
;227 8
param233 
.33 
	SqlDbType33 
=33 
	SqlDbType33 (
.33( )
NVarChar33) 1
;331 2
param244 
.44 
Value44 
=44 
TextBox244 #
.44# $
Text44$ (
;44( )
param255 
.55 
	Direction55 
=55 
ParameterDirection55 1
.551 2
Input552 7
;557 8
param366 
.66 
ParameterName66  
=66! "
$str66# (
;66( )
param377 
.77 
DbType77 
=77 
DbType77 "
.77" #
Int3277# (
;77( )
cmd99 
.99 

Parameters99 
.99 
Add99 
(99 
param199 %
)99% &
;99& '
cmd:: 
.:: 

Parameters:: 
.:: 
Add:: 
(:: 
param2:: %
)::% &
;::& '
ConnectionString>> 
=>> 
$str	>> ü
;
>>ü †
cn?? 
.?? 
ConnectionString?? 
=??  !
ConnectionString??" 2
;??2 3
cn@@ 
.@@ 
Open@@ 
(@@ 
)@@ 
;@@ 
cmdAA 
.AA 

ConnectionAA 
=AA 
cnAA 
;AA  
hashCC 
=CC 
cryptCC 
.CC 
compute_hashCC %
(CC% &
TextBox2CC& .
.CC. /
TextCC/ 3
)CC3 4
;CC4 5
QueryStringEE 
=EE 
$strEE (
+EE) *
nometabellaEE+ 6
+EE7 8
$strEE9 [
+EE\ ]
TextBox4EE^ f
.EEf g
TextEEg k
+EEl m
$strEEn r
+FF8 9
TextBox1FF: B
.FFB C
TextFFC G
+FFH I
$strFFJ O
+FFP Q
hashFFR V
+FFW X
$strFFY ]
;FF] ^
cmdMM 
.MM 
CommandTextMM 
=MM 
QueryStringMM )
;MM) *
cmdOO 
.OO 
ExecuteNonQueryOO 
(OO  
)OO  !
;OO! "
cnRR 
.RR 
CloseRR 
(RR 
)RR 
;RR 
}YY 	
}ZZ 
}[[ Ò
nC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Private\riservata.aspx.cs
	namespace++ 	

WebAppDemo++
 
.++ 
privata++ 
{,, 
public-- 

partial-- 
class-- 
	riservata-- "
:--# $
System--% +
.--+ ,
Web--, /
.--/ 0
UI--0 2
.--2 3
Page--3 7
{.. 
	protected// 
void// 
	Page_Load//  
(//  !
object//! '
sender//( .
,//. /
	EventArgs//0 9
e//: ;
)//; <
{00 	
}22 	
	protected55 
void55 
Button1_Click55 $
(55$ %
object55% +
sender55, 2
,552 3
	EventArgs554 =
e55> ?
)55? @
{66 	
FormsAuthentication77 
.77  
SignOut77  '
(77' (
)77( )
;77) *
Response:: 
.:: 
Redirect:: 
(:: 
$str:: /
)::/ 0
;::0 1
};; 	
}<< 
}== µ
iC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Private\XSRF.aspx.cs
	namespace** 	

WebAppDemo**
 
.** 
Private** 
{++ 
public,, 

partial,, 
class,, 
XSRF,, 
:,, 
System,,  &
.,,& '
Web,,' *
.,,* +
UI,,+ -
.,,- .
Page,,. 2
{-- 
string.. 
	parametro.. 
=.. 
$str.. 
;.. 
	protected00 
void00 
	Page_Load00  
(00  !
object00! '
sender00( .
,00. /
	EventArgs000 9
e00: ;
)00; <
{11 	
if22 
(22 
!22 
Page22 
.22 

IsPostBack22  
)22  !
{33 
	parametro88 
=88 
Request88 #
.88# $
QueryString88$ /
[88/ 0
$str880 8
]888 9
;889 :
Session:: 
[:: 
$str::  
]::  !
=::" #
	parametro::$ -
;::- .
}BB 
elseCC 
{DD 
}GG 
}HH 	
	protectedKK 
voidKK 
Button1_ClickKK $
(KK$ %
objectKK% +
senderKK, 2
,KK2 3
	EventArgsKK4 =
eKK> ?
)KK? @
{LL 	
ifMM 
(MM 
TextBox1MM 
.MM 
TextMM 
==MM  
$strMM! '
)MM' (
{NN 
	parametroOO 
=OO 
SessionOO #
[OO# $
$strOO$ ,
]OO, -
.OO- .
ToStringOO. 6
(OO6 7
)OO7 8
;OO8 9
ResponsePP 
.PP 
WritePP 
(PP 
$strPP (
+PP) *
	parametroPP+ 4
)PP4 5
;PP5 6
}QQ 
}RR 	
}SS 
}TT ˙
eC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Prodotti.aspx.cs
	namespace

 	

WebAppDemo


 
{ 
public 

partial 
class 
Prodotti !
:" #
System$ *
.* +
Web+ .
.. /
UI/ 1
.1 2
Page2 6
{ 
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
string 
nometabella 
, 
ConnectionString  0
,0 1
QueryString2 =
;= >
string 
strTemp 
= 
$str 
;  
SqlConnection 
cn 
; 

SqlCommand 
cmd 
; 
SqlDataReader 
rs 
; 
SqlParameter 
param1 
,  
param2! '
;' (
int 
num 
; 
nometabella 
= 
$str #
;# $
cmd 
= 
new 

SqlCommand  
(  !
)! "
;" #
cn 
= 
new 
SqlConnection "
(" #
)# $
;$ %
param1 
= 
new 
SqlParameter %
(% &
)& '
;' (
param2   
=   
new   
SqlParameter   %
(  % &
)  & '
;  ' (
cmd"" 
."" 
CommandTimeout"" 
=""  
$num""! #
;""# $
cmd## 
.## 
CommandType## 
=## 
CommandType## )
.##) *
Text##* .
;##. /
ConnectionString)) 
=)) 
$str	)) ü
;
))ü †
cn** 
.** 
ConnectionString** 
=**  !
ConnectionString**" 2
;**2 3
cn++ 
.++ 
Open++ 
(++ 
)++ 
;++ 
cmd,, 
.,, 

Connection,, 
=,, 
cn,, 
;,,  
QueryString// 
=// 
$str// +
+//, -
nometabella//. 9
;//9 :
cmd22 
.22 
CommandText22 
=22 
QueryString22 )
;22) *
rs44 
=44 
cmd44 
.44 
ExecuteReader44 "
(44" #
)44# $
;44$ %
num66 
=66 
$num66 
;66 
while88 
(88 
rs88 
.88 
Read88 
(88 
)88 
)88 
{99 
num:: 
++:: 
;:: 
if;; 
(;; 
!;; 
rs;; 
.;; 
IsDBNull;;  
(;;  !
$num;;! "
);;" #
);;# $
strTemp<< 
=<< 
rs<<  
.<<  !
GetInt32<<! )
(<<) *
$num<<* +
)<<+ ,
.<<, -
ToString<<- 5
(<<5 6
)<<6 7
;<<7 8
Response== 
.== 
Write== 
(== 
$str== %
+==& '
strTemp==( /
+==0 1
$str==2 5
)==5 6
;==6 7
Response>> 
.>> 
Write>> 
(>> 
$str>> <
+>>= >
strTemp>>? F
+>>G H
$str>>I X
)>>X Y
;>>Y Z
Response?? 
.?? 
Write?? 
(?? 
$str?? &
)??& '
;??' (
}AA 
rsBB 
.BB 
CloseBB 
(BB 
)BB 
;BB 
cnCC 
.CC 
CloseCC 
(CC 
)CC 
;CC 
}EE 	
}FF 
}GG ú&
fC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\prodotti2.aspx.cs
	namespace

 	

WebAppDemo


 
{ 
public 

partial 
class 
	prodotti2 "
:# $
System% +
.+ ,
Web, /
./ 0
UI0 2
.2 3
Page3 7
{ 
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
string 
nometabella 
, 
ConnectionString  0
,0 1
QueryString2 =
;= >
string 
strTemp 
= 
$str 
;  
SqlConnection 
cn 
; 

SqlCommand 
cmd 
; 
SqlDataReader 
rs 
; 
SqlParameter 
param1 
,  
param2! '
;' (
int 
num 
; 
nometabella 
= 
$str #
;# $
string 
id 
= 
Request 
.  
QueryString  +
[+ ,
$str, 0
]0 1
;1 2
cmd 
= 
new 

SqlCommand  
(  !
)! "
;" #
cn 
= 
new 
SqlConnection "
(" #
)# $
;$ %
param1   
=   
new   
SqlParameter   %
(  % &
)  & '
;  ' (
param2!! 
=!! 
new!! 
SqlParameter!! %
(!!% &
)!!& '
;!!' (
cmd## 
.## 
CommandTimeout## 
=##  
$num##! #
;### $
cmd$$ 
.$$ 
CommandType$$ 
=$$ 
CommandType$$ )
.$$) *
Text$$* .
;$$. /
ConnectionString** 
=** 
$str	** ü
;
**ü †
cn++ 
.++ 
ConnectionString++ 
=++  !
ConnectionString++" 2
;++2 3
cn,, 
.,, 
Open,, 
(,, 
),, 
;,, 
cmd-- 
.-- 

Connection-- 
=-- 
cn-- 
;--  
QueryString00 
=00 
$str00 =
+00> ?
nometabella00@ K
+00L M
$str11 
+11 
id11 !
;11! "
cmd55 
.55 
CommandText55 
=55 
QueryString55 )
;55) *
rs77 
=77 
cmd77 
.77 
ExecuteReader77 "
(77" #
)77# $
;77$ %
num99 
=99 
$num99 
;99 
while;; 
(;; 
rs;; 
.;; 
Read;; 
(;; 
);; 
);; 
{<< 
num== 
++== 
;== 
if>> 
(>> 
!>> 
rs>> 
.>> 
IsDBNull>>  
(>>  !
$num>>! "
)>>" #
)>># $
strTemp?? 
=?? 
rs??  
.??  !
GetInt32??! )
(??) *
$num??* +
)??+ ,
.??, -
ToString??- 5
(??5 6
)??6 7
;??7 8
if@@ 
(@@ 
!@@ 
rs@@ 
.@@ 
IsDBNull@@  
(@@  !
$num@@! "
)@@" #
)@@# $
strTempAA 
=AA 
strTempAA %
+AA& '
$strAA( -
+AA. /
rsAA0 2
.AA2 3
	GetStringAA3 <
(AA< =
$numAA= >
)AA> ?
.AA? @
ToStringAA@ H
(AAH I
)AAI J
;AAJ K
ifBB 
(BB 
!BB 
rsBB 
.BB 
IsDBNullBB  
(BB  !
$numBB! "
)BB" #
)BB# $
strTempCC 
=CC 
strTempCC %
+CC& '
$strCC( -
+CC. /
rsCC0 2
.CC2 3
	GetDoubleCC3 <
(CC< =
$numCC= >
)CC> ?
.CC? @
ToStringCC@ H
(CCH I
)CCI J
;CCJ K
ListBox1EE 
.EE 
ItemsEE 
.EE 
AddEE "
(EE" #
strTempEE# *
)EE* +
;EE+ ,
}GG 
rsHH 
.HH 
CloseHH 
(HH 
)HH 
;HH 
cnII 
.II 
CloseII 
(II 
)II 
;II 
}QQ 	
}RR 
}SS ö
oC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str %
)% &
]& '
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str '
)' (
]( )
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
["" 
assembly"" 	
:""	 

AssemblyVersion"" 
("" 
$str"" $
)""$ %
]""% &
[## 
assembly## 	
:##	 

AssemblyFileVersion## 
(## 
$str## (
)##( )
]##) *Û
eC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Redirect.aspx.cs
	namespace 	

WebAppDemo
 
{		 
public

 

partial

 
class

 
Redirect

 !
:

" #
System

$ *
.

* +
Web

+ .
.

. /
UI

/ 1
.

1 2
Page

2 6
{ 
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
} 	
	protected 
void '
RadioButton1_CheckedChanged 2
(2 3
object3 9
sender: @
,@ A
	EventArgsB K
eL M
)M N
{ 	

HyperLink1 
. 
NavigateUrl "
=# $
$str% A
+B C
TextBox1D L
.L M
TextM Q
;Q R
} 	
	protected 
void '
RadioButton2_CheckedChanged 2
(2 3
object3 9
sender: @
,@ A
	EventArgsB K
eL M
)M N
{ 	

HyperLink1 
. 
NavigateUrl "
=# $
Server% +
.+ ,
	UrlEncode, 5
(5 6
TextBox16 >
.> ?
Text? C
)C D
;D E
} 	
} 
} ©
`C:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\RFI.aspx.cs
	namespace-- 	

WebAppDemo--
 
{.. 
public// 

partial// 
class// 
RFI// 
:// 
System// %
.//% &
Web//& )
.//) *
UI//* ,
.//, -
Page//- 1
{00 
string11 
filename11 
;11 
	protected33 
void33 
	Page_Load33  
(33  !
object33! '
sender33( .
,33. /
	EventArgs330 9
e33: ;
)33; <
{44 	
filename55 
=55 
Request55 
.55 
QueryString55 *
[55* +
$str55+ /
]55/ 0
;550 1
TextBox166 
.66 
Text66 
=66 
filename66 $
;66$ %
}77 	
	protected99 
void99 
Button1_Click99 $
(99$ %
object99% +
sender99, 2
,992 3
	EventArgs994 =
e99> ?
)99? @
{:: 	
string;; 
responseFromServer;; %
;;;% &
HttpWebRequestJJ 
requestJJ "
=JJ# $
(JJ% &
HttpWebRequestJJ& 4
)JJ4 5

WebRequestJJ5 ?
.JJ? @
CreateJJ@ F
(JJF G
TextBox1JJG O
.JJO P
TextJJP T
)JJT U
;JJU V
requestMM 
.MM 
CredentialsMM 
=MM  !
CredentialCacheMM" 1
.MM1 2
DefaultCredentialsMM2 D
;MMD E
varOO 
responseOO 
=OO 
requestOO "
.OO" #
GetResponseOO# .
(OO. /
)OO/ 0
;OO0 1
StreamRR 

dataStreamRR 
=RR 
responseRR  (
.RR( )
GetResponseStreamRR) :
(RR: ;
)RR; <
;RR< =
StreamReaderUU 
readerUU 
=UU  !
newUU" %
StreamReaderUU& 2
(UU2 3

dataStreamUU3 =
)UU= >
;UU> ?
responseFromServerWW 
=WW  
readerWW! '
.WW' (
	ReadToEndWW( 1
(WW1 2
)WW2 3
;WW3 4
ResponseYY 
.YY 
WriteYY 
(YY 
responseFromServerYY -
)YY- .
;YY. /
}ZZ 	
}[[ 
}\\ ±
hC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\Welcomepage.aspx.cs
	namespace 	

WebAppDemo
 
{		 
public

 

partial

 
class

 
Welcomepage

 $
:

% &
System

' -
.

- .
Web

. 1
.

1 2
UI

2 4
.

4 5
Page

5 9
{ 
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
string 
nome 
= 
Request !
.! "
QueryString" -
[- .
$str. 8
]8 9
;9 :
} 	
} 
} ≈
kC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\XPathInjection.aspx.cs
	namespace		 	

WebAppDemo		
 
{

 
public 

partial 
class 
XPathInjection '
:( )
System* 0
.0 1
Web1 4
.4 5
UI5 7
.7 8
Page8 <
{ 
	protected 
void 
	Page_Load  
(  !
object! '
sender( .
,. /
	EventArgs0 9
e: ;
); <
{ 	
} 	
	protected 
void 
Button1_Click $
($ %
object% +
sender, 2
,2 3
	EventArgs4 =
e> ?
)? @
{ 	
XmlDocument 
xmlDoc 
=  
new! $
XmlDocument% 0
(0 1
)1 2
;2 3
string 
path 
= 
Server  
.  !
MapPath! (
(( )
$str) ,
), -
;- .
xmlDoc 
. 
Load 
( 
path 
+ 
$str +
)+ ,
;, -
XmlNamespaceManager 
nsmgr  %
=& '
new( +
XmlNamespaceManager, ?
(? @
xmlDoc@ F
.F G
	NameTableG P
)P Q
;Q R
nsmgr 
. 
AddNamespace 
( 
$str #
,# $
$str% 2
)2 3
;3 4
string 
FindUserXPath  
;  !
FindUserXPath 
= 
$str :
+; <
TextBox1= E
.E F
TextF J
+K L
$strM f
+g h
TextBox2i q
.q r
Textr v
+w x
$stry }
;} ~

XmlElement 
root 
= 
xmlDoc $
.$ %
DocumentElement% 4
;4 5
XmlNode 
node 
= 
root 
.  
SelectSingleNode  0
(0 1
FindUserXPath1 >
)> ?
;? @
if 
( 
node 
!= 
null 
) 
{   
Label3!! 
.!! 
Text!! 
=!! 
$str!! ,
;!!, -
}"" 
else## 
{$$ 
Label3%% 
.%% 
Text%% 
=%% 
$str%% A
;%%A B
}&& 
}(( 	
})) 
}** 
`C:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\xss.aspx.cs
	namespace** 	

WebAppDemo**
 
{++ 
public,, 

partial,, 
class,, 
xss,, 
:,, 
System,, %
.,,% &
Web,,& )
.,,) *
UI,,* ,
.,,, -
Page,,- 1
{-- 
	protected.. 
void.. 
	Page_Load..  
(..  !
object..! '
sender..( .
,... /
	EventArgs..0 9
e..: ;
)..; <
{// 	
}11 	
}22 
}33 Á
eC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\xss_elab.aspx.cs
	namespace,, 	

WebAppDemo,,
 
{-- 
public.. 

partial.. 
class.. 
xss_elab.. !
:.." #
System..$ *
...* +
Web..+ .
.... /
UI../ 1
...1 2
Page..2 6
{// 
	protected00 
void00 
	Page_Load00  
(00  !
object00! '
sender00( .
,00. /
	EventArgs000 9
e00: ;
)00; <
{11 	
string22 
testo22 
;22 
ContentPlaceHolder33 
mp33 !
;33! "
try55 
{66 
if77 
(77 
Page77 
.77 
PreviousPage77 %
!=77& (
null77) -
)77- .
{88 
testo>> 
=>> 
(>> 
(>> 
TextBox>> %
)>>% &
PreviousPage>>& 2
.>>2 3
FindControl>>3 >
(>>> ?
$str>>? I
)>>I J
)>>J K
.>>K L
Text>>L P
;>>P Q
Response`` 
.`` 
Write`` #
(``# $
testo``$ )
)``) *
;``* +
}ff 
}gg 
catchhh 
(hh 
	Exceptionhh 
excphh !
)hh! "
{ii 
Responsejj 
.jj 
Writejj 
(jj 
excpjj #
.jj# $
Messagejj$ +
)jj+ ,
;jj, -
}kk 
}ll 	
}mm 
}nn á

`C:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\XXE.aspx.cs
	namespace** 	

WebAppDemo**
 
{++ 
public,, 

partial,, 
class,, 
XXE,, 
:,, 
System,, %
.,,% &
Web,,& )
.,,) *
UI,,* ,
.,,, -
Page,,- 1
{-- 
	protected.. 
void.. 
	Page_Load..  
(..  !
object..! '
sender..( .
,... /
	EventArgs..0 9
e..: ;
)..; <
{// 	
}22 	
	protected55 
void55 
Button1_Click55 $
(55$ %
object55% +
sender55, 2
,552 3
	EventArgs554 =
e55> ?
)55? @
{66 	
}88 	
	protected;; 
void;; 
Button2_Click;; $
(;;$ %
object;;% +
sender;;, 2
,;;2 3
	EventArgs;;4 =
e;;> ?
);;? @
{<< 	
TextBox1== 
.== 
Text== 
=== 
$str	== Ä
+
==Å Ç
TextBox2
==É ã
.
==ã å
Text
==å ê
+
==ë í
$str
==ì ¨
;
==¨ ≠
}>> 	
}?? 
}@@ ¡4
eC:\Corsi_informatica\Sicurezza_Informatica\Secure Coding\VulnerableWebApp\WebAppDemo\XXE_elab.aspx.cs
	namespace-- 	

WebAppDemo--
 
{.. 
public// 

partial// 
class// 
XXE_elab// !
://" #
System//$ *
.//* +
Web//+ .
.//. /
UI/// 1
.//1 2
Page//2 6
{00 
string11 
xml11 
;11 
	protected33 
void33 
	Page_Load33  
(33  !
object33! '
sender33( .
,33. /
	EventArgs330 9
e33: ;
)33; <
{44 	
if55 
(55 
!55 
Page55 
.55 

IsPostBack55  
)55  !
{66 
if77 
(77 
PreviousPage77  
!=77! #
null77$ (
)77( )
{88 
xml99 
=99 
(99 
(99 
TextBox99 #
)99# $
PreviousPage99$ 0
.990 1
FindControl991 <
(99< =
$str99= G
)99G H
)99H I
.99I J
Text99J N
;99N O
XmlReaderSettings;; %
rs;;& (
=;;) *
new;;+ .
XmlReaderSettings;;/ @
(;;@ A
);;A B
;;;B C
rs== 
.== 
DtdProcessing== #
===$ %
DtdProcessing==& 3
.==3 4
Prohibit==4 <
;==< =
	XmlReader?? 
myReader?? &
=??' (
	XmlReader??) 2
.??2 3
Create??3 9
(??9 :
new??: =
StringReader??> J
(??J K
xml??K N
)??N O
,??O P
rs??Q S
)??S T
;??T U
XPathDocumentAA !
xmlDocAA" (
=AA) *
newAA+ .
XPathDocumentAA/ <
(AA< =
myReaderAA= E
)AAE F
;AAF G
XPathNavigatorCC "
navCC# &
=CC' (
xmlDocCC) /
.CC/ 0
CreateNavigatorCC0 ?
(CC? @
)CC@ A
;CCA B
ResponseEE 
.EE 
WriteEE "
(EE" #
$strEE# 1
+EE2 3
navEE4 7
.EE7 8
InnerXmlEE8 @
.EE@ A
ToStringEEA I
(EEI J
)EEJ K
)EEK L
;EEL M
}GG 
}HH 
}II 	
	protectedMM 
voidMM 
Button1_ClickMM $
(MM$ %
objectMM% +
senderMM, 2
,MM2 3
	EventArgsMM4 =
eMM> ?
)MM? @
{NN 	
stringOO 
fileNameOO 
=OO 
ServerOO $
.OO$ %
MapPathOO% ,
(OO, -
$strOO- 6
)OO6 7
;OO7 8
XPathDocumentRR 
xmlDocRR  
=RR! "
newRR# &
XPathDocumentRR' 4
(RR4 5
fileNameRR5 =
)RR= >
;RR> ?
XPathNavigatorTT 
navTT 
=TT  
xmlDocTT! '
.TT' (
CreateNavigatorTT( 7
(TT7 8
)TT8 9
;TT9 :
ResponseVV 
.VV 
WriteVV 
(VV 
$strVV '
+VV( )
navVV* -
.VV- .
InnerXmlVV. 6
.VV6 7
ToStringVV7 ?
(VV? @
)VV@ A
)VVA B
;VVB C
}WW 	
	protectedZZ 
voidZZ 
Button2_ClickZZ $
(ZZ$ %
objectZZ% +
senderZZ, 2
,ZZ2 3
	EventArgsZZ4 =
eZZ> ?
)ZZ? @
{[[ 	
XmlTextReader^^ 
myReader^^ "
=^^# $
new^^% (
XmlTextReader^^) 6
(^^6 7
new^^7 :
StringReader^^; G
(^^G H
xml^^H K
)^^K L
)^^L M
;^^M N
while`` 
(`` 
myReader`` 
.`` 
Read``  
(``  !
)``! "
)``" #
{aa 
ifbb 
(bb 
myReaderbb 
.bb 
NodeTypebb %
==bb& (
XmlNodeTypebb) 4
.bb4 5
Elementbb5 <
)bb< =
{cc 
Responsedd 
.dd 
Writedd "
(dd" #
myReaderdd# +
.dd+ ,&
ReadElementContentAsStringdd, F
(ddF G
)ddG H
)ddH I
;ddI J
}ee 
}ff 
}hh 	
	protectedjj 
voidjj 
Button3_Clickjj $
(jj$ %
objectjj% +
senderjj, 2
,jj2 3
	EventArgsjj4 =
ejj> ?
)jj? @
{kk 	
XmlDocumentmm 
xmlDocmm 
=mm  
newmm! $
XmlDocumentmm% 0
(mm0 1
)mm1 2
;mm2 3
xmlDocqq 
.qq 
LoadXmlqq 
(qq 
xmlqq 
)qq 
;qq  
Responsess 
.ss 
Writess 
(ss 
xmlDocss !
.ss! "
	InnerTextss" +
)ss+ ,
;ss, -
}vv 	
	protectedxx 
voidxx 
Button4_Clickxx $
(xx$ %
objectxx% +
senderxx, 2
,xx2 3
	EventArgsxx4 =
exx> ?
)xx? @
{yy 	
stringzz 
fileNamezz 
=zz 
Serverzz $
.zz$ %
MapPathzz% ,
(zz, -
$strzz- 6
)zz6 7
;zz7 8
XmlReaderSettings|| 
xmlsett|| %
=||& '
new||( +
XmlReaderSettings||, =
(||= >
)||> ?
;||? @
xmlsett}} 
.}} 
DtdProcessing}} !
=}}" #
DtdProcessing}}$ 1
.}}1 2
Parse}}2 7
;}}7 8
	XmlReader 
myReader 
=  
	XmlReader! *
.* +
Create+ 1
(1 2
fileName2 :
,: ;
xmlsett; B
)B C
;C D
XPathDocument
ÇÇ 
xmlDoc
ÇÇ  
=
ÇÇ! "
new
ÇÇ# &
XPathDocument
ÇÇ' 4
(
ÇÇ4 5
myReader
ÇÇ5 =
)
ÇÇ= >
;
ÇÇ> ?
XPathNavigator
ÑÑ 
nav
ÑÑ 
=
ÑÑ  
xmlDoc
ÑÑ! '
.
ÑÑ' (
CreateNavigator
ÑÑ( 7
(
ÑÑ7 8
)
ÑÑ8 9
;
ÑÑ9 :
Response
ÜÜ 
.
ÜÜ 
Write
ÜÜ 
(
ÜÜ 
$str
ÜÜ (
+
ÜÜ) *
nav
ÜÜ+ .
.
ÜÜ. /
InnerXml
ÜÜ/ 7
.
ÜÜ7 8
ToString
ÜÜ8 @
(
ÜÜ@ A
)
ÜÜA B
)
ÜÜB C
;
ÜÜC D
}
áá 	
}
àà 
}ââ 